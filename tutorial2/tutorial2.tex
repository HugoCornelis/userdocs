\documentclass[12pt]{article}
\usepackage[dvips]{epsfig}
\usepackage{color}
%e.g.  \textcolor{red,green,blue}{text}
\usepackage{url}
\usepackage[colorlinks=true]{hyperref}

\begin{document}

\section*{GENESIS: Tutorial 2}

{\bf Related Documentation:}
% start: userdocs-tag-replace-items related-do-nothing
% end: userdocs-tag-replace-items related-do-nothing

\section*{Using the GENESIS Shell for\\Multi-compartment Modeling and Simulation}

In this second of two introductory tutorials you will be guided through a brief session using the \href{../gshell/gshell.tex}{GENESIS shell}. In this tutorial it is assumed that you are familiar with the contents of \href{../tutorial1/tutorial1.tex}{Tutorial 1} and the links it contains. You will be shown how to use basic features of the GENESIS shell to create, explore, and run a realistic multi-compartment model neuron. For example:
\begin{verbatim}
    ndf_load cells/purkinje/edsjb1994.ndf
    run /Purkinje 0.1
\end{verbatim}

\subsection*{Import Model}

A large number of predefined model neurons come bundled with the GENESIS distribution. The command
\begin{verbatim}
    genesis > show_library
\end{verbatim}
lists the available model libraries. Example library files can be found with
\begin{verbatim}
    genesis > show_library ndf examples
\end{verbatim}
You can display the contents of the single cell library with
\begin{verbatim}
    genesis > show_library ndf cells
\end{verbatim}
which returns in part
\begin{verbatim}
    ---
    ndf_library:
     cells:
       ...
       - purkinje/
       ...
\end{verbatim}
This indicates the existence of a directory in the library where one or more Purkinje cell models are stored.

The contents of the {\it purkinje} directory can be displayed with
\begin{verbatim}
    genesis > show_library ndf cells/purkinje
    ---
    ndf_library:
     cells/purkinje:
       - edsjb1994.ndf
       - edsjb1994_partitioned.ndf
\end{verbatim}

To run one of these models the model description file (NDF) must first be loaded into the GENESIS shell.  (To learn more about the NDF format see  \href{../ndf-file-format/ndf-file-format.tex}{Introduction to the NDF File Format}.) For example, to load the multicompartment De Schutter and Bower Purkinje cell model referenced above, enter
\begin{verbatim}
    ndf_load cells/purkinje/edsjb1994.ndf
\end{verbatim}
This command results in the complete Purkinje cell model being made available to the GENESIS shell.

{\bf Note:} Currently, it is not advisable to load more than one model at a time into the GENESIS shell. Although multiple models can be loaded, the command {\it ndf\_save} will save all models to the ndf file. To change to a different model you can either issue the {\tt delete} command (see example below) or exit the {\bf G-Shell}, restart GENESIS, and load the new model (see the \href{../gshell/gshell.tex}{Introduction to the GENESIS Shell}).

\subsection*{Explore Model}

To determine the name of a model that has been loaded and made available to the GENESIS shell (i.e. the name located at the root node of the element hierarchy tree), enter, for example 
\begin{verbatim}
    genesis > list_elements
    ---
    - /Purkinje
\end{verbatim}
We can then determine the child elements of {\tt /Purkinje} with
\begin{verbatim}
    genesis > list_elements /Purkinje
    ---
    - /Purkinje/segments
\end{verbatim}
A list of all segments in the model can then be generated with another {\tt list\_elements} command
\begin{verbatim}
    genesis > list_elements /Purkinje/segments
    ---
    - /Purkinje/segments/soma
    - /Purkinje/segments/main[0]
    . . .
    - /Purkinje/segments/b3s46[15]
\end{verbatim}
Choosing one of the segments at random (here, for example {\it /Purkinje/segments/b3s45[10]}), we can generate a list of the elements that are associated with the given segment either by using the full pathname
\begin{verbatim}
    genesis > list_elements /Purkinje/segments/b3s45[10]
    ---
    - /Purkinje/segments/b3s45[10]/cat
    - /Purkinje/segments/b3s45[10]/cap
    - /Purkinje/segments/b3s45[10]/kc
    - /Purkinje/segments/b3s45[10]/k2
    - /Purkinje/segments/b3s45[10]/km
    - /Purkinje/segments/b3s45[10]/ca_pool
    - /Purkinje/segments/b3s45[10]/stellate
    - /Purkinje/segments/b3s45[10]/Purkinje_spine_0
\end{verbatim}
or by making the chosen element the current working element via the {\it ce} (change working element) command. We can then check what the current working element is with the {\it pwe} (print working element) command
\begin{verbatim}
    genesis > ce /Purkinje/segments/b3s45[10]
    genesis > pwe
    /Purkinje/segments/b3s45[10]
    genesis > list_elements .
    ---
    - /Purkinje/segments/b3s45[10]/cat
    . . .
    - /Purkinje/segments/b3s45[10]/Purkinje_spine_0
\end{verbatim}
The ability to change the current working element allows us to either check the value of the model parameters associated with the current working element (such as {\tt RM} or {\tt CM}) via the command {\it show\_model\_parameters}, change default parameter values via the {\it set\_model\_parameter} command or view the scaled value of the parameter via the command {\it show\_parameter\_scaled}, e.g.
\begin{verbatim}
    genesis > pwe
    /Purkinje/segments/b3s45[10]
    genesis > show_model_parameters .
    ---
       'parameter name': SURFACE
       type: number
       value: 1.54645e-10
       . . .
       'parameter name': ELEAK
       type: number
       value: -0.08
    genesis > show_parameter /Purkinje/segments/b3s45[10] RM
    value = 3    
    genesis > set_model_parameter /Purkinje/segments/b3s45[10] RM 2.0
    genesis > show_parameter /Purkinje/segments/b3s45[10] RM
    value = 2
    genesis > show_parameter_scaled /Purkinje/segments/b3s45[10] RM
    scaled value = 1.29328e+10
\end{verbatim}

{\bf Note:}
\begin{itemize}

\item The commands {\it ce}, {\it set\_model\_parameter}, and {\it show\_parameter} currently only accept the full path name (e.g. {\it  /Purkinje/segments/b3s45[10]}) to a segment even if the parameter to be queried or changed is in the current working element. % or just the segment name itself (as given in the above example).  Parameter values associated with a given element can be changed using either the full path name or making the given segment the current working element (as with the above example).

\item In the GENESIS shell the commands ``{\bf .}'' and ``{\bf ..}'' operate in the same way as when employed to traverse the Unix file system (see \href{../unix-linux/unix-linux.tex}{Introduction to Unix and the Linux graphical desktop}). The ``{\bf ..}'' operator may be chained, e.g. ``{\bf ../../../}''.

\item Also remember that in the GENESIS documentation, an elipsis ($\ldots$) indicates missing lines.

\end{itemize}

Another Purkinje cell in the NDF library {\it cells/purkinje} is {\it edsjb1994\_partitioned.ndf}. This model is identical to edsjb1994.ndf with the exception that its morphology has been repartitioned. It is simple to delete the current model and load the repartitioned version
\begin{verbatim}
    genesis > delete /Purkinje
        delete: /Purkinje
    genesis > ndf_load cells/purkinje/edsjb1994_partitioned.ndf
\end{verbatim}
We can now ask for a summary of the morphology
\begin{verbatim}
    genesis > morphology_summarize /Purkinje
\end{verbatim}
which generates the following output
\begin{verbatim}
    Number of segments: 4548
    Number of segments without parents: 1
    Number of segment tips: 1474
\end{verbatim}
We can also list the segments in {\it /Purkinje/segments}
\begin{verbatim}
    genesis > list_elements /Purkinje/segments
    ---
    - /Purkinje/segments/soma
    - /Purkinje/segments/main
    - /Purkinje/segments/branches
    - /Purkinje/segments/branchlets
\end{verbatim}
or find the nine segments in the main dendrite ({\it /Purkinje/segments/main}), e.g.
\begin{verbatim}
    genesis > list_elements /Purkinje/segments/main
    ---
    - /Purkinje/segments/main/main[0]
    - /Purkinje/segments/main/main[1]
    . . . 
    - /Purkinje/segments/main/main[8]
\end{verbatim}
and so on for the branches (``{\tt list\_elements /Purkinje/segments/branches}'') and branchlets (``{\tt list\_elements /Purkinje/segments/branchlets}'').

It is also possible to list the location of the spine heads in the dendritic morphology
\begin{verbatim}
    genesis > morphology_list_spine_heads /Purkinje
\end{verbatim}
This generates considerable output that locates each dendritic spine head in the element hierarchy
\begin{verbatim}
    tips:
      name: Purkinje
      names:
        - /Purkinje/segments/b0s01[1]/Purkinje_spine_0/head
        - /Purkinje/segments/b0s01[2]/Purkinje_spine_0/head
        . . .
        - /Purkinje/segments/b3s46[15]/Purkinje_spine_0/head
\end{verbatim}

\subsection*{Save Model}

There are two ways to save a model.

\begin{enumerate}
   \item{\bf Explicitly:}
   \item{\bf Generically:}
\end{enumerate}


\subsection*{Define Simulation Constants}

UNDER CONSTRUCTION

\subsection*{Define Simulation Inputs}

There are currently three ways to provide stimulation inputs to a single cell model. 

\subsubsection*{Synaptic Activation}

Once the model is loaded into the {\bf G-Shell}, either of the following input paradigms can be activated to provide synaptic activation:

\begin{enumerate}
   \item{\bf Endogenous Poissonian Synaptic Activation:} The simplest way to activate synapses.
   \paragraph{Excitatory:} The following command applies a Poisson stream of event times to glutamate synapses on spin heads at 25\,Hz.
\begin{verbatim}
   genesis > set_runtime_parameter spine::/Purk_spine/head/par FREQUENCY 25
\end{verbatim}
   \paragraph{Inhibitory:} The following command applies a Poisson stream of event times to GABAergic synapses on dendrites flagged as thick at 1\,Hz.
\begin{verbatim}
   genesis > set_runtime_parameter thickd::gaba::/Purk_GABA FREQUENCY 1
\end{verbatim}
Information about what run time parameters have been set can be obtained with:
\begin{verbatim}
   genesis > show_runtime_parameters
\end{verbatim}
which for the endogenous excitatory and inhibitory Poissonian synaptic activation set above would return:
\begin{verbatim} 
   runtime_parameters:
     - component_name: thickd::gaba::/Purk_GABA
       field: FREQUENCY
       value: 1
       value_type: number
     - component_name: spine::/Purk_spine/head/par
       field: FREQUENCY
       value: 25
       value_type: number
 \end{verbatim}
    
   \item{\bf Extrinsic Synaptic Activation:} This provides a much more flexible way to activate synapses than the endogenous activation method. Here, explicit synaptic activation times pre-generated outside of GENESIS (e.g. from a specified probability distribution using Matlab) are read from a file containing the required event list.
   
   After identifying which synapses should be activated, e.g.
   \begin{verbatim}
   genesis > show_parameter /Purkinje/segments/b1s06[182] SOMATOPETAL_BRANCHPOINTS
      value = 23 
   \end{verbatim}
   The event list can then be attached to the spine heads of the specified dendritic segment:
   \begin{verbatim}
   genesis > set_runtime_parameter /Purkinje/segments/b1s06[182]/Purkinje_spine_0/head/par/synapse EVENT_FILENAME event_data/events.yml
   \end{verbatim}   
\end{enumerate}

\subsection*{Define Simulation Outputs}

The following commands will define simulation outputs from the soma:
\begin{verbatim}
   genesis > add_output /Purkinje/segments/soma Vm
   genesis > add_output /Purkinje/segments/soma/ca_pool Ca
\end{verbatim}
for the membrane potential ($V_m$) and calcium concentration ($[Ca]_{in}$).

\subsection*{Check Simulation}

The following command, as given in \href{../tutorial1/tutorial1.tex}{Tutorial 1}, is run to check the simulation:
\begin{verbatim}
   genesis > check /Purkinje
\end{verbatim}

\subsection*{Run Simulation}

To run a simulation for 10\,s we can use the same command as used for the simple one compartment model in \href{../tutorial1/tutorial1.tex}{Tutorial 1}
\begin{verbatim}
    genesis > run /Purkinje 10.00
\end{verbatim}

\subsection*{Reset Simulation}

A simulation can be returned to its initial state where the time step of the simulation is set to zero and the initial values for all solved variables are loaded with the following command:
\begin{verbatim}
    genesis > reset /Purkinje
\end{verbatim}

\subsection*{Save Model State}

UNDER CONSTRUCTION

\subsection*{Check Simulation Output}

UNDER CONSTRUCTION


\end{document}