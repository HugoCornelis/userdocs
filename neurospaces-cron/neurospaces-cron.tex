\documentclass[12pt]{article}
\usepackage{verbatim}
\usepackage[dvips]{epsfig}
\usepackage{color}
\usepackage{url}
\usepackage[colorlinks=true]{hyperref}

\begin{document}

\section*{GENESIS: Documentation}

{\bf Related Documentation:}
% start: userdocs-tag-replace-items related-do-nothing
% end: userdocs-tag-replace-items related-do-nothing

\href{../neurospaces-tester/neurospaces-tester.tex}{\bf Automated\,Tester}

\section*{The {\it neurospaces\_cron} Script}

This script is part of the \href{../developer-package}{\it DeveloperPackage}, its function is to perform sanity checks for communicating with a repository, system installation, and runs tests to check that software packages are properly working. Here we introduce how to use the script, set up a {\it cron} job, and how to avoid some common pitfalls.

\subsection*{Running {\it neurospaces\_cron}}

The {\it neurospaces\_cron} script can be run by entering ``{\tt neurospaces\_cron}'' from the command line after installing the {\it DeveloperPackage}. There are command line arguments available to customize aspects of a {\it cron} job, e.g.
\begin{itemize}
   \item {\tt --outputdir <absolute path to target directory>:} Set the output directory for {\it cron} job output logs.
   \item {\tt --config <file name>:} Read a YAML configuration file for setting {\it cron} job parameters.
\end{itemize}
However, it is preferable to create a YAML configuration file to set {\it cron} job parameters.

\subsection*{The  {\it neurospaces\_cron} Configuration File}

The  {\it neurospaces\_cron} configuration file is a YAML formatted file containing values that can be set for the following optional parameters:
\begin{itemize}
   \item[]{\bf MAILTO:} Email address for recipient of email notifying {\it cron} job completion.
   \item[]{\bf MAILFROM:} Email address from which {\it cron} job completion email is sent.
   \item[]{\bf MAILBCC:} Email addresses to send a courtesy copy of the cron jobs report to.  
   \item[]{\bf OUTPUTDIR:} Target directory for writing {\it cron} job output log data.
   \item[]{\bf URL:} http link to serve test harness output.
   \item[]{\bf DOXYGENOUTPUT:} The local directory that holds doxygen html output.
   \item[]{\bf DOXYGENURL:} http link to serve doxygen output.
   \item[]{\bf REGTESTOUTPUT:} The local directory containing output of regression test html.
   \item[]{\bf REGTESTURL:} http link to serve regression test html output.
   \item[]{\bf LOGROTATE:} The number of output logs to rotate on successive runs.   
   \item[]{\bf NOCHECK:} If set to True, the cronjob will not run tests to check the source code. Proceeds as normal when set to False. This option case insensetive. 
   \item[]{\bf PKGDEB:} Directory to place built Debian packages.
\end{itemize}

\subsubsection*{Example configuration file:}

\begin{verbatim}
---
MAILTO: my@email.com
MAILFROM: g3tester@repo-genesis3.cbi.utsa.edu
MAILBCC: user1@email.com, user2@email.com, user3@email.com
OUTPUTDIR: /var/www/tests
URL: http://repo-genesis3.cbi.utsa.edu/tests
DOXYGENOUTPUT: /var/www/doxygen
DOXYGENURL: http://repo-genesis3.cbi.utsa.edu/doxygen
REGTESTOUTPUT: /var/www/regtests
REGTESTURL: http://repo-genesis3.cbi.utsa.edu/regtests
LOGROTATE: 10
NOCHECK: False
PKGDEB: /var/www/debian

\end{verbatim}

\subsection*{The Cron Job}

Setting up a {\it cron} job typically requires administrator rights. There are several ways to run a {\it cron} job. We now give some of the easiest ways to do this on a Linux based machine.

To automate the running of a {\it cron} job create the directory {\it /etc/cron.d}. A {\it cron} job formatted text file placed in this directory will be picked up by the {\it cron} daemon. A typical invocation for {\it neurospaces\_cron} would be with a line like this:
\begin{verbatim}
   01 00 * * * g3tester neurospaces_cron
\end{verbatim}
This job is set to run at exactly one minute after midnight. To run the job more frequently you could do this:
\begin{verbatim}
   01 */8 * * * g3tester neurospaces_cron
\end{verbatim}
which would make the {\it cron} job run every eight hours.

{\bf Note:} The {\tt g3tester} is a user set up for permissions to perform a {\tt sudo make install}, and {\tt sudo make uninstall}. To set up a regular user to use sudo, add them to the {\it /etc/sudoers} file (see next section).

\subsection*{The Sudoers File}

The sudoers file grants a particular user the privileges to run a command or set of commands in superuser mode. The file is located at {\it /etc/sudoers}. There are variables in the file which must be set to allow a regular user to perform the {\it neurospaces\_cron} tests as they require GENESIS components to be installed and uninstalled to the system.

To allow the {\tt g3tester} user to perform any command anywhere on the system in superuser mode the following line can be placed into the sudoer's file:
\begin{verbatim}
   g3tester ALL=(ALL) ALL
\end{verbatim}
This configuration line still results in the system asking for a password, which will stop the {\it cron} job. To prevent this, the ``{\tt NOPASSWD}'' option can be inserted:
\begin{verbatim}
   g3tester ALL=(ALL) NOPASSWD: ALL
\end{verbatim}
Since it is desirable to restrict a regular user to commands they absolutely need to run, their privileges can be limited to a particular list of command, e.g.
\begin{verbatim}
   g3tester ALL=(ALL) NOPASSWD: /usr/bin/make /usr/local/bin/neurospaces_cron
\end{verbatim}
This limits the user {\tt g3tester} to executing only the commands {\it neurospaces\_cron} and {\it make}, without requiring a password. More commands can be added as needed simply by appending them to the list with a space delimiter. 

\end{document}
