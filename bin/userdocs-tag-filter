#!/usr/bin/perl -w 
#!/usr/bin/perl -w -d:ptkdb
#


use strict;


use YAML;


sub tag_filter
{
    my $filename = shift;

    my $tag = shift;

    # load the descriptor

    my $descriptor = YAML::LoadFile($filename);

    # convert the tags to a hash with true values

    my $tags = $descriptor->{tags};

    foreach (@$tags)
    {
	if (/$tag/i)
	{

	    return 1;
	}
    }

    return 0;
}


sub main
{
    my $source = '.';

    my $tag = $ARGV[0];

    if (!defined $tag)
    {
	die "$0: please give a tag value on the command line";
    }

    my $all_documentation_descriptors
	= [
	   map { chomp; $_ }
	   `find $source -name "descriptor.yml"`,
	  ];

    my $all_documentation_tag_filtered
	= [
	   map
	   {
	       s(/descriptor.yml$)()i; $_;
	   }
	   grep
	   {
	       tag_filter($_, $tag);
	   }
	   @$all_documentation_descriptors,
	  ];

    print Dump($all_documentation_tag_filtered);
}


main();


